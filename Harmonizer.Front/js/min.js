!function(){"use strict";angular.module("app",["ngResource","ngRoute","ngAnimate"]),angular.module("app").config(["$logProvider",function(a){a.debugEnabled(!0)}]),angular.module("app").run(["$rootScope",function(a){a.apiError=!1,a.$on("$routeChangeStart",function(){a.stateIsLoading=!0}),a.$on("$routeChangeSuccess",function(){a.stateIsLoading=!1}),a.$on("$routeChangeError",function(){console.log("error in route loading"),a.stateIsLoading=!0,a.apiError=!0})}]),angular.module("app").config(["$routeProvider",function(a){a.when("/",{controller:"homeController",controllerAs:"home",templateUrl:"js/homePage/_home.tpl.html",resolve:{resolvedStaticData:["staticDataService","soundFactory",function(a,b){return a.getStaticData().then(function(a){return b.inititalize(a)})}]}}).when("/load/:seqId",{controller:"homeController",controllerAs:"home",templateUrl:"js/homePage/_home.tpl.html",resolve:{resolvedStaticData:["staticDataService","soundFactory",function(a,b){return a.getStaticData().then(function(a){return b.inititalize(a)})}]}})}])}(),function(){"use strict";angular.module("app").directive("chordBlock",["chordService","$log","staticDataService",function(a,b,c){var d=function(a){var b=function(b){a.flipped&&(a.chord.notation=c.createChordNotation(b,a.chord.chordTypeId))},d=function(b){a.flipped&&(a.chord.notation=c.createChordNotation(a.chord.noteId,b))};a.$watch(function(){return a.chord.noteId},b),a.$watch(function(){return a.chord.chordTypeId},d)};return{restrict:"E",replace:!0,link:d,transclude:!0,scope:{index:"=",chord:"=",durations:"=",isSelected:"=",moveLeft:"&",moveRight:"&",setSelected:"&",decreaseLength:"&",increaseLength:"&",remove:"&"},templateUrl:"js/chords/chordBlock.html",controller:["$scope","$log","staticDataService",function(a){this.flip=function(b){a.flipped=!a.flipped,"closing"===b&&a.setSelected({newIndex:-1})}}],controllerAs:"chordBlockController"}}])}(),function(){"use strict";angular.module("app").service("chordService",["$log","$q","staticDataService",function(a,b,c){this.setPlaying=function(a,b){for(var c=0;c<a.length;c++)a[c].playing=!1;a.length&&-1!==b&&(a[b].playing=!0)},this.addAChord=function(a,b,d,e){var f=c.createChordNotation(b,d),g={noteId:b,chordTypeId:d,durationId:e,notation:f,playing:!1};a.push(g)},this.removeAChord=function(a,b){a.splice(b,1)},this.increaseChordLength=function(a,b,c){for(var d=a[c].durationId,e=0;e<b.length;e++)if(d===b[e].id&&e!==b.id-1)return void(a[c].durationId=b[e+1].id)},this.decreaseChordLength=function(a,b,c){for(var d=a[c].durationId,e=0;e<b.length;e++)if(d===b[e].id)return void(a[c].durationId=b[e-1].id)},this.moveChordLeft=function(a,b){var c=parseInt(b);if(0!==c){var d=a[c-1];a[c-1]=a[c],a[c]=d}},this.moveChordRight=function(a,b){var c=parseInt(b);if(c!==a.length-1){var d=a[c+1];a[c+1]=a[c],a[c]=d}},this.reduceForPost=function(a){for(var b=[],c=0;c<a.length;c++)b.push({note:a[c].note,type:a[c].chordType.id,length:a[c].duration.id});return b}}])}(),function(){"use strict";angular.module("app").value("fileQualityAndExtension",".mp3")}(),function(){"use strict";angular.module("app").directive("configSelect",["$log",function(){var a=function(){};return{restrict:"E",replace:!0,controllerAs:"wheelController",link:a,scope:{elements:"=",selected:"=",change:"&"},templateUrl:"js/control/configSelect.html"}}])}(),function(){"use strict";function a(a,b,c,d,e){var f=b(c+"/api/sequence/:id"),g=function(){var b=e.defer(),c=d.seqId;return"undefined"!=typeof c?(a.debug("sequence ID route param : ",c),f.get({id:c},function(d){a.debug("sequence.chords",d.chords),b.resolve({sequenceId:c,chords:d.chords})})):b.reject("ho nooes"),b.promise},h=function(a){var b=e.defer(),c={id:a.sequenceId,name:"premiere sequence",tempo:a.configuration.tempoId,description:"premiere description",chords:a.chords};return f.save(c,function(a){b.resolve(a)}),b.promise};return{loadSequenceFromQuery:g,saveSequence:h}}angular.module("app").factory("sequenceFactory",["$log","$resource","apiurl","$routeParams","$q",a])}(),function(){"use strict";angular.module("app").service("staticDataService",["$log","$http","$q","_","apiurl",function(a,b,c,d,e){var f,g=function(){var a=c.defer();return b({method:"GET",url:e+"/api/staticdata/",cache:!0}).success(function(b){var c=i(b);a.resolve(c),f=c}).error(function(b,c){a.reject("oops ! "+c)}),a.promise},h=function(a,b){var c=d.result(d.find(f.notes,function(b){return b.id===a}),"name"),e=d.result(d.find(f.chordTypes,function(a){return a.id===b}),"notation");return c+e},i=function(a){var b={notes:a.notes,chordTypes:a.chordTypes,durations:a.durations,tempi:a.tempi,chordEditor:{noteId:a.defaultNoteId,chordTypeId:a.defaultChordTypeId,durationId:a.defaultDurationId},configuration:{tempoId:a.defaultTempoId,metronome:!1}};return b};return{getStaticData:g,createChordNotation:h,buildStaticData:i}}])}(),function(){"use strict";var a=function(a,b,c,d,e,f,g){var h=this;h.model=e,h.model.chords=[],h.model.selectedChordIndex=-1,h.model.sequenceId=0,h.setChordSelected=function(a){h.model.selectedChordIndex=a;var b=h.model.chordEditor;h.model.chordEditor=a>-1?h.model.chords[a]:b},h.updateSelectedChord=function(a,b){-1!==h.model.selectedChordIndex&&(h.model.chords[h.model.selectedChordIndex][a]=b)},h.increaseChordLength=function(a){c.increaseChordLength(h.model.chords,h.model.durations,a)},h.decreaseChordLength=function(a){c.decreaseChordLength(h.model.chords,h.model.durations,a)},h.removeAChord=function(a){c.removeAChord(h.model.chords,a)},h.moveChordLeft=function(a){c.moveChordLeft(h.model.chords,a)},h.moveChordRight=function(a){c.moveChordRight(h.model.chords,a)},h.toggleMetronome=b.toggleMetronome,h.insertChord=function(){c.addAChord(h.model.chords,h.model.chordEditor.noteId,h.model.chordEditor.chordTypeId,h.model.chordEditor.durationId),b.playASound(h.model.chordEditor.noteId,h.model.chordEditor.chordTypeId,h.model.chordEditor.durationId,h.model.configuration.tempoId)},h.play=function(){b.playSequence(h.model.chords,h.model.configuration.tempoId,h.model.metronome)},h.stop=function(){b.stop(h.model.chords)},d.loadSequenceFromQuery().then(function(a){h.model.chords=a.chords,h.model.sequenceId=a.sequenceId}),h.save=function(){d.saveSequence(h.model).then(function(b){a.debug("data",b),g.path("/load/"+b.id)})}};angular.module("app").controller("homeController",["$log","soundFactory","chordService","sequenceFactory","resolvedStaticData","$routeParams","$location",a])}(),function(){"use strict";angular.module("app").controller("sideMenuController",["$log",function(){var a=this;this.isOpen=!1,this.openMenu=function(){a.isOpen=!0},this.closeMenu=function(){a.isOpen=!1}}])}(),function(){"use strict";angular.module("app").factory("soundFactory",["fileQualityAndExtension","staticDataService","$log","chordService","$interval","$q",function(a,b,c,d,e,f){var g,h,i,j,k=[],l=null,m=[],n=0,o=null,p=1,q=!1,r=new Howl({urls:["/samples/metronome.mp3"],sprite:{tic:[600,300],tac:[1200,300]}}),s=function(b){g=b.notes,h=b.chordTypes,i=b.durations;for(var c=f.defer(),d=0;d<g.length;d++){for(var e={},j=0,l=0;l<h.length;l++){j=h[l].spriteOffset;var m=h[l].id,n=j,o=3590;e[m]=[n,o]}var p="/samples/"+z(g[d].id)+"_sprite"+a;k[g[d].id]=new Howl({urls:[p],sprite:e})}return c.resolve(b),c.promise},t=function(a,b,c){if(a.length){j=b;var d=6e4/j,f=1,g=1;p=1,u(a),c&&r.play("tic"),v(a,0),l=e(function(){return c&&r.play(0===g?"tic":"tac"),m[p]===f&&(v(a,p),p++),f>=n?void y(a):(f++,void(g=(g+1)%4))},d)}},u=function(a){n=0,m=[];for(var b=0;b<a.length;b++)m.push(n),n+=a[b].durationId},v=function(a,b){w(b),x(a[b].noteId,a[b].chordTypeId,a[b].durationId,j),d.setPlaying(a,b)},w=function(a,b){var c=a[b]?a[b].noteId:"",d=a[b+1]?a[b+1].noteId:"";q=c===d},x=function(a,b,c,d){var e=6e4*c/d,f=.95,g=q?.04:.14;k[a].volume(1),k[a].play(b),o=a,setTimeout(function(){k[a].fadeOut(0,e*g,function(){k[a].stop()},0)},e*f)},y=function(a){d.setPlaying(a,-1),e.cancel(l)},z=function(a){switch(a){case"as":return"bb";case"cs":return"db";case"ds":return"eb";case"fs":return"gb";case"gs":return"ab";case"a":case"ab":case"b":case"bb":case"c":case"e":case"eb":case"f":case"g":case"gb":return a;default:return a}};return{inititalize:s,playSequence:t,playOneChordInSequence:v,playASound:x,stop:y,getTheRightFileName:z}}])}(),function(){"use strict";angular.module("app").factory("_",["$window",function(a){return a._}])}();