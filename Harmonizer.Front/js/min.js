!function(){"use strict";angular.module("app",["ngResource","ngRoute","ngAnimate"]),angular.module("app").config(["$logProvider",function(a){a.debugEnabled(!0)}]),angular.module("app").config(["$routeProvider",function(a){a.when("/",{controller:"homeController",controllerAs:"home",templateUrl:"js/homePage/_home.tpl.html",resolve:{resolvedStaticData:["staticDataService","soundFactory",function(a,b){return a.getStaticData().then(function(a){return b.inititalize(a)})}]}}).when("/load/:seqId",{controller:"homeController",controllerAs:"home",templateUrl:"js/homePage/_home.tpl.html",resolve:{resolvedStaticData:["staticDataService","soundFactory",function(a,b){return a.getStaticData().then(function(a){return b.inititalize(a)})}]}})}])}(),function(){"use strict";angular.module("app").directive("chordBlock",["chordService","$log",function(a,b){var c=function(c){b.debug("chordDirective durations",c.durations),c.decreaseChordLength=a.decreaseChordLength,c.increaseChordLength=a.increaseChordLength,c.removeAChord=a.removeAChord,c.moveChordLeft=a.moveChordLeft,c.moveChordRight=a.moveChordRight};return{restrict:"E",replace:!0,link:c,scope:{chord:"=",index:"@",durations:"=",chords:"="},templateUrl:"js/chords/chordBlock.html",controller:["$scope","$log",function(a){a.flip=function(){a.flipped=!a.flipped}}]}}])}(),function(){"use strict";angular.module("app").service("chordService",["$log","$q","staticDataService",function(a,b,c){this.setPlaying=function(a,b){for(var c=0;c<a.length;c++)a[c].playing=!1;a.length&&-1!==b&&(a[b].playing=!0)},this.addAChord=function(a,b,d,e){var f=c.createChordNotation(b,d),g={noteId:b,chordTypeId:d,durationId:e,chordNotation:f,playing:!1};a.push(g)},this.removeAChord=function(a,b){a.splice(b,1)},this.increaseChordLength=function(a,b,c){for(var d=a[c].durationId,e=0;e<b.length;e++)if(d===b[e].id&&e!==b.id-1)return void(a[c].durationId=b[e+1].id)},this.decreaseChordLength=function(a,b,c){for(var d=a[c].durationId,e=0;e<b.length;e++)if(d===b[e].id)return void(a[c].durationId=b[e-1].id)},this.moveChordLeft=function(a,b){var c=parseInt(b);if(0!==c){var d=a[c-1];a[c-1]=a[c],a[c]=d}},this.moveChordRight=function(a,b){var c=parseInt(b);if(c!==a.length-1){var d=a[c+1];a[c+1]=a[c],a[c]=d}},this.reduceForPost=function(a){for(var b=[],c=0;c<a.length;c++)b.push({note:a[c].note,type:a[c].chordType.id,length:a[c].duration.id});return b}}])}(),function(){"use strict";angular.module("app").value("fileQualityAndExtension",".mp3")}(),function(){"use strict";angular.module("app").directive("wheelselect",["$log",function(){var a=function(){};return{restrict:"E",replace:!0,link:a,scope:{elements:"=",selected:"="},templateUrl:"js/control/wheelSelect.html"}}])}(),function(){"use strict";angular.module("app").factory("sequenceResource",["$log","$resource",function(a,b){return b("http://localhost:59400/api/sequence/:id")}])}(),function(){"use strict";angular.module("app").service("staticDataService",["$log","$http","$q","_",function(a,b,c,d){var e,f=function(){var a=c.defer();return b({method:"GET",url:"http://localhost:59400/api/staticdata/",cache:!0}).success(function(b){a.resolve(b),e=b}).error(function(b,c){a.reject("oops ! "+c)}),a.promise},g=function(b,c){var f=d.result(d.find(e.notes,function(a){return a.id===b}),"name"),g=d.result(d.find(e.chordTypes,function(a){return a.id===c}),"notation");return a.debug("found ",f,g),f+g};return{getStaticData:f,createChordNotation:g}}])}(),function(){"use strict";angular.module("app").controller("homeController",["$log","soundFactory","chordService","sequenceResource","resolvedStaticData","$routeParams","_",function(a,b,c,d,e,f){var g=this;this.chordService={};var h=f.seqId;"undefined"!=typeof h&&(a.debug("sequence ID route param : ",h),d.get({id:h},function(b){g.chords=b.chords,a.debug("chords get",chords)})),this.chords=[],this.notes=e.notes,this.chordTypes=e.chordTypes,this.durations=e.durations,this.tempi=e.tempi,this.noteSelectedId=e.defaultNoteId,this.chordTypeSelectedId=e.defaultChordTypeId,this.durationSelectedId=e.defaultDurationId,this.tempoSelectedId=e.defaultTempoId,this.metronome=b.metronome,this.insertChord=function(){c.addAChord(this.chords,this.noteSelectedId,this.chordTypeSelectedId,this.durationSelectedId),b.playASound(this.noteSelectedId,this.chordTypeSelectedId,this.durationSelectedId,this.tempoSelectedId)},this.play=function(){b.playSequence(this.chords,this.tempoSelectedId)},this.stop=function(){b.stop(this.chords)},this.toggleMetronome=b.toggleMetronome,this.save=function(){a.debug(g.tempoSelectedId);var b={name:"premiere sequence",tempo:g.tempoSelectedId,description:"premiere description"};d.save(b,function(){})}}])}(),function(){"use strict";angular.module("app").controller("sideMenuController",["$log",function(){var a=this;this.isOpen=!1,this.openMenu=function(){a.isOpen=!0},this.closeMenu=function(){a.isOpen=!1}}])}(),function(){"use strict";angular.module("app").factory("soundFactory",["fileQualityAndExtension","staticDataService","$log","chordService","$interval","$q",function(a,b,c,d,e,f){var g,h,i,j,k=[],l=null,m=[],n=0,o=null,p=1,q=!1,r=new Howl({urls:["/samples/metronome.mp3"],sprite:{tic:[600,300],tac:[1200,300]}}),s=!0,t=function(b){g=b.notes,h=b.chordTypes,i=b.durations;for(var c=f.defer(),d=0;d<g.length;d++){for(var e={},j=0,l=0;l<h.length;l++){j=h[l].spriteOffset;var m=h[l].id,n=j,o=3590;e[m]=[n,o]}var p="/samples/"+B(g[d].id)+"_sprite"+a;k[g[d].id]=new Howl({urls:[p],sprite:e})}return c.resolve(b),c.promise},u=function(a,b){if(a.length){j=b;var c=6e4/j,d=1,f=1;p=1,v(a),s&&r.play("tic"),w(a,0),l=e(function(){return s&&r.play(0===f?"tic":"tac"),m[p]===d&&(w(a,p),p++),d>=n?void z(a):(d++,void(f=(f+1)%4))},c)}},v=function(a){n=0,m=[];for(var b=0;b<a.length;b++)m.push(n),n+=a[b].durationId},w=function(a,b){x(b),y(a[b].noteId,a[b].chordTypeId,a[b].durationId,j),d.setPlaying(a,b)},x=function(a,b){var c=a[b]?a[b].noteId:"",d=a[b+1]?a[b+1].noteId:"";q=c===d},y=function(a,b,c,d){var e=6e4*c/d,f=.95,g=q?.04:.14;k[a].volume(1),k[a].play(b),o=a,setTimeout(function(){k[a].fadeOut(0,e*g,function(){k[a].stop()},0)},e*f)},z=function(a){d.setPlaying(a,-1),e.cancel(l)},A=function(){s=!s},B=function(a){switch(a){case"as":return"bb";case"cs":return"db";case"ds":return"eb";case"fs":return"gb";case"gs":return"ab";case"a":case"ab":case"b":case"bb":case"c":case"e":case"eb":case"f":case"g":case"gb":return a;default:return a}};return{inititalize:t,playSequence:u,playOneChordInSequence:w,playASound:y,stop:z,toggleMetronome:A,getTheRightFileName:B}}])}(),function(){"use strict";angular.module("app").factory("_",["$window",function(a){return a._}])}();